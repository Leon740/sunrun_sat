import{b as k,j as e,B as T,r as g,S as D,c as H,R as B,u as P,a as Y,A as z}from"./index-CzZb75z9.js";import{A as J}from"./Avatar-DLL3U01g.js";import{S as A,G as C,I as $}from"./Status-DgKJjzpZ.js";import{F as j}from"./FormButton-3as50PDl.js";import{P as w}from"./position-CtgMU1tI.js";function R({_id:l,label:n,color:c}){const r=k(),p=()=>{r(`${B.employee}/${l}`)};return e.jsx(T,{type:"button",ariaLabel:`Navigate to ${n}`,handleOnClick:p,className:"w-full",children:e.jsx(N,{label:n,className:`rounded-8 ${c}`})})}function N({label:l,className:n}){return e.jsx("div",{className:`cursor-pointer w-full text-16 text-dark_navy font-roobert_regular text-left py-8 px-16 border-light_navy ease-in-out duration-300 ${n}`,children:l})}function K({employees:l,crew:n,color:c,title:r,handleOnChange:p,isEditable:i=!1}){const f=l.map(o=>({value:o._id,label:o.nickname})),x={value:"",label:"Add"},E=r==="Foreman"||r==="Lead"?f:[x,...f],m=g.useMemo(()=>{const o=l.find(h=>h.crew===n);return o?{value:o._id,label:o.nickname}:x},[l,n]),[y,O]=g.useState(m);return g.useEffect(()=>{y.value!==m.value&&p(m.value,y.value,n)},[y]),e.jsx("div",{className:"basis-128",children:i?e.jsx(D,{isUpdatesBetweenRenders:!0,options:E,defaultOption:m,setActiveOption:O,renderActiveOption:o=>e.jsx(N,{label:o.label,className:`border-t-0 ${c}`}),renderOptions:o=>o.map(h=>e.jsx(H,{option:h,children:e.jsx(N,{label:h.label,className:"border-t-2 bg-sky_blue hover:bg-light_navy"})},`Employee_${r}_SelectOption_${h.value}`)),activeMaxHeightClassName:"max-h-[256px]"}):e.jsx(R,{_id:m.value,label:m.label,color:c})})}function Q({employeesHashTable:l}){const{allEmployees:n,employeesByPosition:c}=l,[r,p]=g.useState(n),i="unassigned",f={};c.Foreman.forEach(s=>{const t=r[s].crew;t!==i&&(f[s]=t)}),f.New="New";const x={Foreman:[],Lead:[],Installer:[],Electrician:[]};w.forEach(s=>{x[s.title]=c[s.title].map(t=>r[t])});const E=g.useRef(f),m=(s,t)=>{E.current[s]=t},[y,O]=g.useState(f),o=(s,t)=>{O(E.current);const a=r[s],u=(a==null?void 0:a.crew)||i;w.forEach(b=>{const d=x[b.title].find(_=>_.crew===u);d&&p(_=>({..._,[d._id]:{...d,crew:t}}))})},h=(s,t,a)=>{s!==t&&p(u=>{const b=u[s],d=u[t];return!s&&t?(console.log("1. (!prevId && newId)"),{...u,[t]:{...d,crew:a}}):s&&!t?(console.log("2. (prevId && !newId)"),{...u,[s]:{...b,crew:i}}):s&&t?(console.log("3. (prevId && newId)"),b.position==="Foreman"&&d.position==="Foreman"?(console.log("ForemanOnChange"),{...u,[s]:{...b,crew:d.crew},[t]:{...d,crew:b.crew}}):{...u,[s]:{...b,crew:i},[t]:{...d,crew:a}}):u})},[v,S]=g.useState(!1),{status:F,triggerRequest:L}=Y({query:"put",url:z.EMPLOYEE_API_URI}),I=()=>{S(!0)},M=k(),q=()=>{M(B.newEmployee)},U=()=>{S(!1),p(l.allEmployees)},G=()=>{S(!1),L({reqBody:Object.values(r)})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"py-32 flex flex-col gap-32",children:[e.jsx("div",{className:"flex flex-row justify-between",children:v?e.jsxs(e.Fragment,{children:[e.jsx(j,{type:"button",ariaLabel:"Reset Crews",bg:"bg-red",handleOnClick:U,icon:"delete",label:"Reset Crews"}),e.jsx(j,{type:"button",ariaLabel:"Save Crews",bg:"bg-green",handleOnClick:G,icon:"done",label:"Save Crews"})]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{type:"button",ariaLabel:"Edit Crews",bg:"bg-yellow",handleOnClick:I,icon:"edit",label:"Edit Crews"}),e.jsx(j,{type:"button",ariaLabel:"New Employee",bg:"bg-white",handleOnClick:q,icon:"profile",label:"New Employee"})]})}),e.jsx(A,{status:F,errorMessage:"Error updating Employees",successMessage:"Employees updated successfully"})]}),Object.entries(y).map(([s,t])=>e.jsx(C,{name:t,isEditable:v&&t!==i,handleOnChange:a=>m(s,a),handleOnSave:a=>o(s,a),children:e.jsx("div",{className:"flex flex-row flex-wrap gap-16",children:w.map(a=>e.jsx(K,{employees:x[a.title],crew:t,color:a.color,title:a.title,handleOnChange:h,isEditable:v},`${t}_Crew_${a.title}_Select`))})},`${t}_Crew`)),e.jsx("div",{className:"pt-32",children:e.jsx(C,{name:"unassigned employees",children:w.map(s=>{const t=x[s.title].filter(a=>a.crew===i);return t.length>0&&e.jsx("div",{className:"flex flex-row flex-wrap gap-16",children:t.map(a=>e.jsx("div",{className:"basis-128",children:e.jsx(R,{_id:a._id,label:a.nickname,color:s.color})},`${i}_Crew_${s.title}_List_${a._id}_Item`))},`${i}_Crew_${s.title}_List`)})})})]})}function V(){const{employeesHashTable:l,status:n}=P();return l?e.jsx(Q,{employeesHashTable:l}):e.jsx(A,{status:n,errorMessage:"Error fetching Employees"})}function te(){const{employee:l}=P(),{firstname:n,lastname:c}=l,r={firstname:n,lastname:c};return e.jsxs("form",{className:"w-full flex flex-col gap-32",children:[e.jsx(J,{name:r,isEditable:!1}),e.jsx(C,{name:"employeeId",children:e.jsx($,{id:"employeeId",value:l.employeeId,isEditable:!1})}),e.jsx(C,{name:"branch",children:e.jsx($,{id:"branch",value:l.branch,isEditable:!1})}),e.jsx(V,{})]})}export{te as default};
