import{j as t,r as x,c as M,u as k,A as P}from"./index-DihfN6Tf.js";import{L as I,G as D,S as Y}from"./Status-DsXCdxri.js";import{P as N}from"./position-CtgMU1tI.js";function A({name:e,color:a,onChange:n,isChecked:s=!1,disabled:i=!1}){const o=a==="yellow",c=`${i?"":"cursor-pointer"}`;return t.jsxs("label",{className:`flex flex-row items-center gap-8 ${o?"text-yellow":"text-light_navy"}`,children:[t.jsx("input",{type:"radio",name:e,value:e,checked:s,disabled:i,className:"hidden",onChange:u=>n(u.target.value)}),t.jsx("span",{className:`w-16 h-16 rounded-50 border-2 transition
          ${c}
          ${o?`border-yellow ${s?"bg-yellow":""}`:`border-light_navy ${s?"bg-light_navy":""}`}
          `}),t.jsx("span",{className:`font-roobert_semibold text-20 capitalize ${c}`,children:e})]})}function O({radioGroupValue:e,radioGroupOnChange:a,disabled:n=!1}){const[s,i]=x.useState(e),o=u=>{i(u),a(u)},c=s==="Yes";return t.jsxs("div",{className:"w-full flex flex-col gap-16",children:[t.jsxs("div",{className:"flex flex-row justify-center gap-64",children:[t.jsx(A,{name:"Yes",color:"yellow",onChange:o,isChecked:c,disabled:n}),t.jsx(A,{name:"No",color:"light_navy",onChange:o,isChecked:s==="No",disabled:n})]}),n&&t.jsx("p",{className:"font-roobert_regular text-16 text-red text-center",children:"Can't update your vote since it's less than 1 day notice."}),s&&t.jsx("div",{className:`w-full font-roobert_semibold text-16 text-center p-8 rounded-8 ${c?"text-dark_navy bg-yellow":"text-sky_blue bg-light_navy"}`,children:c?"Letâ€™s knock it out.":"Recharge and do it next time."})]})}const U=(e,a)=>{const n=Math.abs(a.getTime()-e.getTime());return Math.ceil(n/(1e3*60*60*24))};function C({children:e}){return e?t.jsx("ul",{className:"flex flex-row flex-wrap gap-16",children:e}):null}function R({children:e,color:a}){return t.jsx("li",{className:`font-roobert_regular text-16 text-dark_navy p-8 rounded-8 ${a}`,children:e})}function q({name:e,date:a,employees:n,saturdayOnChange:s,activeEmployee:i,allEmployees:o,initialCrews:c,isManager:u}){const[p,_]=x.useState(new Set(n)),[S,$]=x.useState(p.has(i._id)?"Yes":"No");x.useEffect(()=>{_(l=>{const r=new Set(l);return S==="Yes"?r.add(i._id):r.delete(i._id),r})},[S]);const d=Array.from(p);x.useEffect(()=>{d.length!==n.length&&s({name:e,date:a,employees:d})},[d]);const f=new Date,[m,F,L]=a.split("-").map(Number),T=U(f,new Date(m,F-1,L))<2,w={};c.forEach(l=>{w[l]={Foreman:{},Lead:{},Installer:{},Electrician:{}}});const b={Foreman:[],Lead:[],Installer:[],Electrician:[]};d.forEach(l=>{const r=o[l];return r.crew!=="unassigned"&&(w[r.crew][r.position]=r),b[r.position].push(r),r});const j=[];Object.entries(w).forEach(([l,r])=>{var g,y,h,v;((g=r.Foreman)!=null&&g._id&&((y=r.Lead)!=null&&y._id)||(h=r.Foreman)!=null&&h._id&&((v=r.Electrician)!=null&&v._id))&&j.push(l)});const E=a;return t.jsxs("section",{className:"flex flex-col gap-32","aria-label":e,children:[t.jsx("h2",{"aria-label":e,className:"flex justify-center",children:t.jsx(I,{name:e,text:"text-20"})}),!u&&t.jsx(O,{radioGroupValue:S,radioGroupOnChange:$,disabled:T}),d.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(I,{name:"Sunrunners coming in",text:"text-20"}),j.length>0&&j.map(l=>{const r=w[l],g=`${E}_${l}`;return t.jsx(D,{name:l,children:t.jsx(C,{children:N.map(y=>{const h=r[y.title];if(h._id)return t.jsx(R,{color:y.color,children:h.nickname},`${g}_${h._id}`)})})},g)}),t.jsx(D,{name:"Crews to be determined",children:N.map(l=>{const r=b[l.title].filter(y=>!j.includes(y.crew)),g=`${E}_${l.title}`;return r.length>0&&t.jsx(C,{children:r.map(y=>t.jsx(R,{color:l.color,children:y.nickname},`${g}_${y._id}`))},g)})})]})]})}const B=()=>{const e=new Date,a=new Date(`${e.getFullYear()}-${e.getMonth()+2}-${e.getDate()}`),n=[];for(let s=e;s<=a;s.setDate(s.getDate()+1))if(s.getDay()===6){const o={name:s.toLocaleDateString("en-US",{month:"long",day:"numeric"}),date:`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}`,employees:[]};n.push(o)}return n},G=e=>{const a=B();if(e){const n=new Date,s=e.filter(o=>n<new Date(o.date));return a.map(o=>{const c=s.find(u=>u.date===o.date);return c||o})}return a};function H({existingSaturdays:e,activeEmployee:a,employeesHashTable:n,isManager:s}){const{allEmployees:i,employeesByPosition:o}=n,c=new Set;o.Foreman.forEach(d=>{const f=i[d].crew;f!=="unassigned"&&c.add(f)});const[u,p]=x.useState(()=>G(e)),{status:_,triggerRequest:S}=k({query:"put",url:`${P.SATURDAYS_API_URI(a.branchId)}`}),$=d=>{p(f=>f.map(m=>m.date===d.date?d:m))};return x.useEffect(()=>{S({reqBody:u}),console.log("putActiveSaturdaysStatus",_)},[u]),t.jsx("div",{className:"grow flex flex-col gap-32",children:u.map(({name:d,date:f,employees:m})=>t.jsx(q,{name:d,date:f,employees:m,saturdayOnChange:$,activeEmployee:a,allEmployees:i,initialCrews:c,isManager:s},`${f}_Saturday`))})}function z({activeEmployee:e,employeesHashTable:a,isManager:n}){const[s,i]=x.useState(),{status:o,triggerRequest:c}=k({query:"get",url:`${P.SATURDAYS_API_URI(e.branchId)}`,onSuccess:u=>{i(u)}});return x.useEffect(()=>{c()},[]),s?t.jsx(H,{existingSaturdays:s,activeEmployee:e,employeesHashTable:a,isManager:n}):t.jsx(Y,{status:o,errorMessage:"Error fetching Saturdays"})}function Q(){const{employee:e,employeesHashTable:a,employeesHashTableStatus:n,isManager:s}=M();return a?t.jsx(z,{activeEmployee:e,employeesHashTable:a,isManager:s}):t.jsx(Y,{status:n,errorMessage:"Error fetching Employees"})}export{Q as default};
