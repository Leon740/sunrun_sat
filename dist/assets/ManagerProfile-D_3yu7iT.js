import{d as B,j as e,B as D,r as h,S as H,b as Y,R as A,c as k,u as z,A as J}from"./index-WRblNOmq.js";import{A as K}from"./Avatar-1wpbu5Ap.js";import{S as P,G as C,I as $}from"./Status-4t2SuwKi.js";import{F as w}from"./FormButton-CiJ3zu8R.js";import{P as j}from"./position-CtgMU1tI.js";function L({_id:a,label:l,color:m}){const i=B(),p=()=>{i(`${A.employee}/${a}`)};return e.jsx(D,{type:"button",ariaLabel:`Navigate to ${l}`,handleOnClick:p,className:"w-full",children:e.jsx(N,{label:l,className:`rounded-8 ${m}`})})}function N({label:a,className:l}){return e.jsx("div",{className:`cursor-pointer w-full text-16 text-dark_navy font-roobert_regular text-left py-8 px-16 border-light_navy ease-in-out duration-300 ${l}`,children:a})}function Q({employees:a,crew:l,color:m,title:i,handleOnChange:p,isEditable:g=!1}){const c=a.map(o=>({value:o._id,label:o.nickname})),f={value:"",label:"Add"},y=i==="Foreman"||i==="Lead"?c:[f,...c],u=h.useMemo(()=>{const o=a.find(x=>x.crew===l);return o?{value:o._id,label:o.nickname}:f},[a,l]),[E,O]=h.useState(u);return h.useEffect(()=>{E.value!==u.value&&p(u.value,E.value,l)},[E]),e.jsx("div",{className:"basis-128",children:g?e.jsx(H,{isUpdatesBetweenRenders:!0,options:y,defaultOption:u,setActiveOption:O,renderActiveOption:o=>e.jsx(N,{label:o.label,className:`border-t-0 ${m}`}),renderOptions:o=>o.map(x=>e.jsx(Y,{option:x,children:e.jsx(N,{label:x.label,className:"border-t-2 bg-sky_blue hover:bg-light_navy"})},`${x.value}_Option_Employee_${i}_Select`))}):e.jsx(L,{_id:u.value,label:u.label,color:m})})}function V({employeesHashTable:a}){const{employee:l}=k(),{allEmployees:m,employeesByPosition:i}=a,[p,g]=h.useState(m),c="unassigned",f={};i.Foreman.forEach(s=>{const t=p[s].crew;t!==c&&(f[s]=t)}),f.New="New";const y={Foreman:[],Lead:[],Installer:[],Electrician:[]};j.forEach(s=>{y[s.title]=i[s.title].map(t=>p[t])});const u=h.useRef(f),E=(s,t)=>{u.current[s]=t},[O,o]=h.useState(f),x=(s,t)=>{o(u.current);const r=p[s],n=(r==null?void 0:r.crew)||c;j.forEach(b=>{const d=y[b.title].find(_=>_.crew===n);d&&g(_=>({..._,[d._id]:{...d,crew:t}}))})},R=(s,t,r)=>{s!==t&&g(n=>{const b=n[s],d=n[t];return!s&&t?(console.log("1. (!prevId && newId)"),{...n,[t]:{...d,crew:r}}):s&&!t?(console.log("2. (prevId && !newId)"),{...n,[s]:{...b,crew:c}}):s&&t?(console.log("3. (prevId && newId)"),b.position==="Foreman"&&d.position==="Foreman"?(console.log("ForemanOnChange"),{...n,[s]:{...b,crew:d.crew},[t]:{...d,crew:b.crew}}):{...n,[s]:{...b,crew:c},[t]:{...d,crew:r}}):n})},[S,v]=h.useState(!1),{status:F,triggerRequest:I}=z({query:"put",url:J.ALL_EMPLOYEES_API_URI(l.branchId)}),M=()=>{v(!0)},U=B(),q=()=>{U(A.newEmployee)},T=()=>{v(!1),g(a.allEmployees)},G=()=>{v(!1),I({reqBody:p})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"py-32 flex flex-col gap-32",children:[e.jsx("div",{className:"flex flex-row justify-between",children:S?e.jsxs(e.Fragment,{children:[e.jsx(w,{type:"button",ariaLabel:"Reset Crews",bg:"bg-red",handleOnClick:T,icon:"delete",label:"Reset Crews"}),e.jsx(w,{type:"button",ariaLabel:"Save Crews",bg:"bg-green",handleOnClick:G,icon:"done",label:"Save Crews"})]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{type:"button",ariaLabel:"Edit Crews",bg:"bg-yellow",handleOnClick:M,icon:"edit",label:"Edit Crews"}),e.jsx(w,{type:"button",ariaLabel:"New Employee",bg:"bg-white",handleOnClick:q,icon:"profile",label:"New Employee"})]})}),e.jsx(P,{status:F,errorMessage:"Error updating Employees",successMessage:"Employees updated successfully"})]}),Object.entries(O).map(([s,t])=>{const r=`${t}_${s}_Crew`;return e.jsx(C,{name:t,isEditable:S&&t!==c,handleOnChange:n=>E(s,n),handleOnSave:n=>x(s,n),children:e.jsx("div",{className:"flex flex-row flex-wrap gap-16",children:j.map(n=>e.jsx(Q,{employees:y[n.title],crew:t,color:n.color,title:n.title,handleOnChange:R,isEditable:S},`${r}_${n.title}_Select`))})},r)}),e.jsx("div",{className:"pt-32",children:e.jsx(C,{name:"unassigned employees",children:j.map(s=>{const t=y[s.title].filter(n=>n.crew===c),r=`${c}_Crew_${s.title}_Ul`;return t.length>0&&e.jsx("ul",{className:"flex flex-row flex-wrap gap-16",children:t.map(n=>e.jsx("li",{className:"basis-128",children:e.jsx(L,{_id:n._id,label:n.nickname,color:s.color})},`${r}_${n._id}_Li`))},r)})})})]})}function W(){const{employeesHashTable:a,employeesHashTableStatus:l}=k();return a?e.jsx(V,{employeesHashTable:a}):e.jsx(P,{status:l,errorMessage:"Error fetching Employees"})}function ne(){const{employee:a}=k(),{firstname:l,lastname:m}=a,i={firstname:l,lastname:m};return e.jsxs("form",{className:"w-full flex flex-col gap-32",children:[e.jsx(K,{name:i,isEditable:!1}),e.jsx(C,{name:"employeeId",children:e.jsx($,{id:"employeeId",value:a.employeeId,isEditable:!1})}),e.jsx(C,{name:"branch",children:e.jsx($,{id:"branch",value:a.branchName,isEditable:!1})}),e.jsx(W,{})]})}export{ne as default};
