import{j as e,r as g,b as k,S as G,c as T,B as H,R as B,u as P,a as Y,A as z}from"./index-CZA-oHBj.js";import{A as D}from"./Avatar-BjyDiHPr.js";import{S as A,I as $}from"./Status-CadRk9lg.js";import{F as w,G as O}from"./FormButton-BlsKOAHj.js";import{P as j}from"./position-CtgMU1tI.js";function C({label:l,className:r}){return e.jsx("div",{className:`cursor-pointer w-full text-16 text-dark_navy font-roobert_regular text-left py-8 px-16 border-light_navy ease-in-out duration-300 ${r}`,children:l})}function J({employees:l,crew:r,color:p,title:o,handleOnChange:h,isEditable:i=!1}){const f=l.map(n=>({value:n._id,label:n.nickname})),x={value:"",label:"Add"},E=o==="Foreman"||o==="Lead"?f:[x,...f],c=g.useMemo(()=>{const n=l.find(u=>u.crew===r);return n?{value:n._id,label:n.nickname}:x},[l,r]),[y,S]=g.useState(c);g.useEffect(()=>{y.value!==c.value&&h(c.value,y.value,r)},[y]);const v=k(),_=()=>{v(`${B.employee}/${c.value}`)};return e.jsx("div",{className:"basis-128",children:i?e.jsx(G,{isUpdatesBetweenRenders:!0,options:E,defaultOption:c,setActiveOption:S,renderActiveOption:n=>e.jsx(C,{label:n.label,className:`border-t-0 ${p}`}),renderOptions:n=>n.map(u=>e.jsx(T,{option:u,children:e.jsx(C,{label:u.label,className:"border-t-2 bg-sky_blue hover:bg-light_navy"})},`Employee_${o}_SelectOption_${u.value}`)),activeMaxHeightClassName:"max-h-[256px]"}):e.jsx(H,{type:"button",ariaLabel:`Navigate to ${c.label}`,handleOnClick:_,className:"w-full",children:e.jsx(C,{label:c.label,className:`rounded-8 ${p}`})})})}function K({employeesHashTable:l}){const{allEmployees:r,employeesByPosition:p}=l,[o,h]=g.useState(r),i="unassigned",f={};p.Foreman.forEach(s=>{const t=o[s].crew;t!==i&&(f[s]=t)}),f.New="New";const x={Foreman:[],Lead:[],Installer:[],Electrician:[]};j.forEach(s=>{x[s.title]=p[s.title].map(t=>o[t])});const E=g.useRef(f),c=(s,t)=>{E.current[s]=t},[y,S]=g.useState(f),v=(s,t)=>{S(E.current);const a=o[s],d=(a==null?void 0:a.crew)||i;j.forEach(b=>{const m=x[b.title].find(N=>N.crew===d);m&&h(N=>({...N,[m._id]:{...m,crew:t}}))})},_=(s,t,a)=>{s!==t&&h(d=>{const b=d[s],m=d[t];return!s&&t?(console.log("1. (!prevId && newId)"),{...d,[t]:{...m,crew:a}}):s&&!t?(console.log("2. (prevId && !newId)"),{...d,[s]:{...b,crew:i}}):s&&t?(console.log("3. (prevId && newId)"),b.position==="Foreman"&&m.position==="Foreman"?(console.log("ForemanOnChange"),{...d,[s]:{...b,crew:m.crew},[t]:{...m,crew:b.crew}}):{...d,[s]:{...b,crew:i},[t]:{...m,crew:a}}):d})},[n,u]=g.useState(!1),{status:R,triggerRequest:F}=Y({query:"put",url:z.EMPLOYEE_API_URI}),L=()=>{u(!0)},I=k(),M=()=>{I(B.newEmployee)},q=()=>{u(!1),h(l.allEmployees)},U=()=>{u(!1),F({reqBody:Object.values(o)})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"py-32 flex flex-col gap-32",children:[e.jsx("div",{className:"flex flex-row justify-between",children:n?e.jsxs(e.Fragment,{children:[e.jsx(w,{type:"button",ariaLabel:"Reset Crews",bg:"bg-red",handleOnClick:q,icon:"delete",label:"Reset Crews"}),e.jsx(w,{type:"button",ariaLabel:"Save Crews",bg:"bg-green",handleOnClick:U,icon:"done",label:"Save Crews"})]}):e.jsxs(e.Fragment,{children:[e.jsx(w,{type:"button",ariaLabel:"Edit Crews",bg:"bg-yellow",handleOnClick:L,icon:"edit",label:"Edit Crews"}),e.jsx(w,{type:"button",ariaLabel:"New Employee",bg:"bg-white",handleOnClick:M,icon:"profile",label:"New Employee"})]})}),e.jsx(A,{status:R,errorMessage:"Error updating Employees.",successMessage:"Employees updated successfully."})]}),Object.entries(y).map(([s,t])=>e.jsx(O,{name:t,isEditable:n&&t!==i,handleOnChange:a=>c(s,a),handleOnSave:a=>v(s,a),children:e.jsx("div",{className:"flex flex-row flex-wrap gap-16",children:j.map(a=>e.jsx(J,{employees:x[a.title],crew:t,color:a.color,title:a.title,handleOnChange:_,isEditable:n},`${t}_Crew_${a.title}_Select`))})},`${t}_Crew`)),e.jsx("div",{className:"pt-32",children:e.jsx(O,{name:"unassigned employees",children:j.map(s=>{const t=x[s.title].filter(a=>a.crew===i);return t.length>0&&e.jsx("div",{className:"flex flex-row flex-wrap gap-16",children:t.map(a=>e.jsx(C,{label:a.nickname,className:`basis-128 rounded-8 ${s.color}`},`${i}_Crew_${s.title}_List_${a._id}_SelectInnerOption`))},`${i}_Crew_${s.title}_List`)})})})]})}function Q(){const{employeesHashTable:l,status:r}=P();return l?e.jsx(K,{employeesHashTable:l}):e.jsx(A,{status:r,errorMessage:"Error fetching Employees."})}function se(){const{employee:l}=P(),{firstname:r,lastname:p}=l,o={firstname:r,lastname:p};return e.jsxs("form",{className:"w-full flex flex-col gap-32",children:[e.jsx(D,{name:o,isEditable:!1}),e.jsx(O,{name:"employeeId",children:e.jsx($,{id:"employeeId",value:l.employeeId,isEditable:!1})}),e.jsx(O,{name:"branch",children:e.jsx($,{id:"branch",value:l.branch,isEditable:!1})}),e.jsx(Q,{})]})}export{se as default};
